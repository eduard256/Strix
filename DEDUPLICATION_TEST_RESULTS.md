# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–æ–≤

## –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
go test -v ./internal/camera/stream -run "Dedup|Worst|Multiple"
```

## ‚úÖ –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

–í—Å–µ —Ç–µ—Å—Ç—ã **PASS**, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω–∏ —É—Å–ø–µ—à–Ω–æ **–î–ï–ú–û–ù–°–¢–†–ò–†–£–Æ–¢ –ü–†–û–ë–õ–ï–ú–£** —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏.

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –¢–µ—Å—Ç 1: HTTP Authentication Variants

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω HTTP endpoint –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 4 —Ä–∞–∑–Ω—ã—Ö URL

```
http://192.168.1.100/snapshot.jpg
http://admin:12345@192.168.1.100/snapshot.jpg
http://192.168.1.100/snapshot.jpg?pwd=12345&user=admin
http://admin:12345@192.168.1.100/snapshot.jpg?pwd=12345&user=admin
```

- **–†–µ–∞–ª—å–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö:** 1 –ø–æ—Ç–æ–∫
- **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è:** 4 URL
- **–ü–æ—Ç–µ—Ä–∏:** 3 –ª–∏—à–Ω–∏—Ö —Ç–µ—Å—Ç–∞ (75%)

---

### –¢–µ—Å—Ç 2: HTTP with Placeholders

**–ü—Ä–æ–±–ª–µ–º–∞:** URL —Å –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–∞–º–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

```
Entry: snapshot.cgi?user=[USERNAME]&pwd=[PASSWORD]

Generated:
http://192.168.1.100/snapshot.cgi?pwd=&user=
http://admin:12345@192.168.1.100/snapshot.cgi?pwd=&user=
http://192.168.1.100/snapshot.cgi?pwd=12345&user=admin
http://admin:12345@192.168.1.100/snapshot.cgi?pwd=12345&user=admin
```

- **–†–µ–∞–ª—å–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö:** 1 –ø–æ—Ç–æ–∫
- **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è:** 4 URL
- **–ü–æ—Ç–µ—Ä–∏:** 3 –ª–∏—à–Ω–∏—Ö —Ç–µ—Å—Ç–∞ (75%)

---

### –¢–µ—Å—Ç 3: RTSP with/without Credentials

**–ü—Ä–æ–±–ª–µ–º–∞:** RTSP –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ–¥–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞

```
rtsp://admin:12345@192.168.1.100/live/main
rtsp://192.168.1.100/live/main
```

- **–†–µ–∞–ª—å–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö:** 1 –ø–æ—Ç–æ–∫
- **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è:** 2 URL
- **–ü–æ—Ç–µ—Ä–∏:** 1 –ª–∏—à–Ω–∏–π —Ç–µ—Å—Ç (50%)

---

### –¢–µ—Å—Ç 4: Multiple Sources (Popular + Model)

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

```
Source 1 (Popular Patterns):
  rtsp://admin:12345@192.168.1.100/Streaming/Channels/101
  rtsp://192.168.1.100/Streaming/Channels/101

Source 2 (Model Patterns):
  rtsp://admin:12345@192.168.1.100/Streaming/Channels/101
  rtsp://192.168.1.100/Streaming/Channels/101
```

**–¢–µ–∫—É—â–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:**
- –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç: 2 —Ç–æ—á–Ω—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (50%)
- –ù–ï –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç: 1 —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –¥—É–±–ª—å

**–ò—Ç–æ–≥–æ:**
- Total generated: 4 URL
- After current dedup: 2 URL
- Real unique: 1 –ø–æ—Ç–æ–∫
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 50%** (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 75%)

---

### –¢–µ—Å—Ç 5: Worst Case Scenario

**–ü—Ä–æ–±–ª–µ–º–∞:** –û–¥–∏–Ω –ø–∞—Ç—Ç–µ—Ä–Ω –∏–∑ 3 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (Popular + Model + ONVIF)

```
Popular patterns generates: 4 URLs
Model patterns generates: 4 URLs
ONVIF returns: 1 URL
```

**–ü–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–π –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏:** 4 URL –æ—Å—Ç–∞—é—Ç—Å—è

```
http://192.168.1.100/snapshot.jpg
http://admin:12345@192.168.1.100/snapshot.jpg
http://192.168.1.100/snapshot.jpg?pwd=12345&user=admin
http://admin:12345@192.168.1.100/snapshot.jpg?pwd=12345&user=admin
```

**Canonical analysis:**
- Real unique streams: **1**
- URLs being tested: **4**
- **Waste: 3 unnecessary tests (75%)**
- **Time waste: ~6 seconds** (assuming 2s per test)

---

## üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã–≤–æ–¥—ã

### 1. –¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏—Ö –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–ü—Ä–æ—Å—Ç–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ `urlMap[url] = true` –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ **—Ç–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è**.

### 2. –ú–∞—Å—à—Ç–∞–± –ø—Ä–æ–±–ª–µ–º—ã

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è | –†–µ–∞–ª—å–Ω–æ | –ü–æ—Ç–µ—Ä–∏ |
|----------|--------------|---------|--------|
| HTTP auth variants | 4 | 1 | 75% |
| RTSP with/without creds | 2 | 1 | 50% |
| Multiple sources | 4 | 1 | 75% |
| Worst case | 4 | 1 | 75% |

**–°—Ä–µ–¥–Ω–µ–µ:** ~69% –ª–∏—à–Ω–∏—Ö —Ç–µ—Å—Ç–æ–≤!

### 3. –†–µ–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

–ü—Ä–∏ —Ç–∏–ø–∏—á–Ω–æ–º —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏:
- **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è:** ~190 URL
- **–†–µ–∞–ª—å–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö:** ~80-95
- **–õ–∏—à–Ω–∏—Ö —Ç–µ—Å—Ç–æ–≤:** 95-110 (50%)
- **–ü–æ—Ç–µ—Ä–∏ –≤—Ä–µ–º–µ–Ω–∏:** 3-4 –º–∏–Ω—É—Ç—ã
- **–õ–∏—à–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∫–∞–º–µ—Ä—É:** 100+ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ü–ª–æ—Ö–æ–π UX:** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–¥–∏–Ω –ø–æ—Ç–æ–∫ 4 —Ä–∞–∑–∞

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–¢–µ—Å—Ç—ã –¥–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å **–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ URL**.

–°–º. —Ñ–∞–π–ª `/tmp/dedup_solutions.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è —Ä–µ—à–µ–Ω–∏–π.

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ–¥—Ö–æ–¥: –ì–∏–±—Ä–∏–¥–Ω—ã–π

1. **–í Builder:** –£–º–µ–Ω—å—à–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (—Å 4 –¥–æ 2-3)
2. **–í Scanner:** –î–æ–±–∞–≤–∏—Ç—å `CanonicalURL()` —Ñ—É–Ω–∫—Ü–∏—é
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è 99% –≤–º–µ—Å—Ç–æ —Ç–µ–∫—É—â–∏—Ö 50%

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã (done)
2. ‚è≥ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `normalizer.go` —Å `CanonicalURL()`
3. ‚è≥ –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `Builder.BuildURLsFromEntry()` - —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
4. ‚è≥ –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `Scanner.collectStreams()` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å canonical map
5. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –≤ –ª–æ–≥–∏
6. ‚è≥ –ü—Ä–æ–≥–Ω–∞—Ç—å —Ç–µ—Å—Ç—ã –∑–∞–Ω–æ–≤–æ –∏ —É–±–µ–¥–∏—Ç—å—Å—è –≤ —É–ª—É—á—à–µ–Ω–∏–∏

---

## üéØ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏—è:

```
Real unique streams: 1
URLs being tested: 1  ‚Üê –≤–º–µ—Å—Ç–æ 4
Waste: 0 unnecessary tests (0%)  ‚Üê –≤–º–µ—Å—Ç–æ 75%
Deduplication effectiveness: 99%  ‚Üê –≤–º–µ—Å—Ç–æ 50%
```
